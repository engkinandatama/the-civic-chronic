---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getCollection } from "astro:content";

const allCases = await getCollection("cases");
// Sort by date descending and get top 3
const recentCases = allCases
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
	.slice(0, 3);
---

<Layout title="The Civic Chronic">
	<Header />

	<main
		class="flex-grow flex flex-col items-center justify-center pt-24 pb-20 px-4 md:px-8 w-full min-h-screen"
	>
		<!-- Hero Section -->
		<div
			class="w-full max-w-4xl flex flex-col items-center text-center mb-16 md:mb-24 animate-fade-in-up"
		>
			<div class="mb-8 text-primary opacity-80">
				<span class="material-symbols-outlined text-5xl">gavel</span>
			</div>

			<h1
				class="font-serif text-5xl md:text-7xl lg:text-8xl font-black text-ink leading-[0.9] tracking-tight mb-6"
			>
				THE CIVIC<br class="hidden md:block" /> CHRONIC
			</h1>

			<div class="relative py-4 px-8">
				<div
					class="absolute top-0 left-1/2 -translate-x-1/2 w-12 h-[1px] bg-primary/30"
				>
				</div>
				<h2
					class="font-serif italic text-lg md:text-2xl text-gray-500 font-light"
				>
					A record of how the world’s systems are meant to work?
				</h2>
				<div
					class="absolute bottom-0 left-1/2 -translate-x-1/2 w-12 h-[1px] bg-primary/30"
				>
				</div>
			</div>
		</div>

		<!-- Manifesto -->
		<article
			class="w-full max-w-[640px] flex flex-col gap-8 text-center md:text-justify leading-relaxed text-gray-800 text-lg md:text-xl font-light"
		>
			<p>
				<span
					class="float-left text-5xl md:text-6xl font-serif font-bold text-primary mr-3 mt-[-10px] leading-none opacity-20"
					>W</span
				>e document the friction of modern life. Not the grand collapses
				that make headlines, but the quiet, systemic grinding of gears
				that were never quite oiled correctly. This is an archive of the
				bureaucratic, the overlooked, and the delightfully broken.
			</p>
			<p>
				From city planning errors that serve no one to forms that submit
				into the digital void, <span class="font-medium text-primary"
					>The Civic Chronic</span
				> serves as a testament to human error in the age of algorithmic efficiency.
				We believe that to truly understand a system, one must first painstakingly
				observe exactly where it fails.
			</p>
			<p>
				This is not a complaint box. It is a museum of intent versus
				reality. Welcome to the archives.
			</p>
		</article>

		<!-- Divider -->
		<div class="w-full max-w-[120px] h-[1px] bg-gray-300 my-16"></div>

		<!-- Abstract Image -->
		<div
			class="w-full max-w-3xl mb-16 grayscale opacity-80 hover:grayscale-0 transition-all duration-700"
		>
			<div
				class="aspect-[21/9] w-full bg-cover bg-center rounded overflow-hidden relative shadow-inner"
				style="background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuAsDv-ktvx6RgpUXK8VsOX7mwfYcmmT3F9DJY2eg-jA6PjrpLdLL72FtF0fKFdkFJsvy1AuqSiHpCVu0S00KdqxIpifubvjgvryiZvZfnlZjZb8fh5mpFjTJuXzJDcSpdXnYhG5PZmVzWfzbIwL-qNvdArkosQp_cG2fusu35ACFhjniVPK_yo_PjpwvsWZYFQ-w-n7KZQ5UsJ_0IP8DXDbrV1acULxvNnaI2UCGDIG_JWMsRxXRAlVa1KindpLUzPPFl_jdeNbIXM-');"
			>
				<div
					class="absolute inset-0 bg-gradient-to-t from-background-light/80 to-transparent mix-blend-overlay"
				>
				</div>
			</div>
			<p
				class="text-xs text-center mt-3 text-gray-400 uppercase tracking-widest font-bold"
			>
				Figure 1.A — The Unused walkway
			</p>
		</div>

		<!-- Latest Entries Grid -->
		<div
			class="w-full max-w-5xl grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12 pt-8 border-t border-gray-200"
		>
			{
				recentCases.map((post) => (
					<a
						href={`/case/${post.slug}`}
						class="group flex flex-col gap-3"
					>
						<div class="aspect-[4/3] w-full bg-gray-200 rounded overflow-hidden relative">
							{post.data.cover_image && (
								<div
									class="w-full h-full bg-cover bg-center transition-transform duration-500 group-hover:scale-105"
									style={`background-image: url('${post.data.cover_image}')`}
								/>
							)}
						</div>
						<div class="flex flex-col">
							<span class="text-xs font-bold text-primary uppercase tracking-wider mb-1">
								{post.data.category}
							</span>
							<h3 class="font-serif text-xl text-ink leading-tight group-hover:underline decoration-1 underline-offset-4">
								{post.data.title}
							</h3>
							<span class="text-sm text-gray-500 mt-1">
								{post.data.location} —{" "}
								{post.data.date.getFullYear()}
							</span>
						</div>
					</a>
				))
			}
		</div>

		<!-- CTA -->
		<div class="mt-16">
			<a
				href="/archive"
				class="inline-block px-8 py-3 border border-gray-300 rounded-full text-sm font-bold uppercase tracking-widest hover:bg-primary hover:text-white hover:border-primary transition-all duration-300"
			>
				Explore the Full Index
			</a>
		</div>
	</main>

	<Footer />
</Layout>
