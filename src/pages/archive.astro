---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { getCollection } from "astro:content";

const allCases = await getCollection("cases");
const sortedCases = allCases.sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
---

<Layout title="Archive | The Civic Chronic">
    <Header />

    <main
        class="flex-grow flex flex-col items-center pt-32 pb-20 px-4 md:px-8 min-h-screen"
    >
        <div class="w-full max-w-5xl mb-12">
            <h1
                class="font-serif text-4xl md:text-5xl font-black text-ink mb-4"
            >
                The Archives
            </h1>
            <p class="text-gray-500 text-lg font-light">
                A complete catalog of documented system failures.
            </p>
        </div>

        <div
            class="w-full max-w-5xl grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
        >
            {
                sortedCases.map((entry) => (
                    <a
                        href={`/case/${entry.slug}`}
                        class="group border border-gray-200 bg-white p-6 hover:shadow-lg transition-all duration-300 flex flex-col h-full"
                    >
                        <div class="flex justify-between items-start mb-4">
                            <span class="text-xs font-bold text-primary uppercase tracking-widest border border-primary/20 px-2 py-1 rounded-sm">
                                {entry.data.category}
                            </span>
                            <span class="text-xs font-mono text-gray-400">
                                {entry.data.date.getFullYear()}
                            </span>
                        </div>

                        <h2 class="font-serif text-2xl font-bold text-ink mb-3 group-hover:text-primary transition-colors">
                            {entry.data.title}
                        </h2>

                        <p class="text-sm text-gray-500 mb-6 line-clamp-3 flex-grow">
                            {entry.body.slice(0, 150)}...
                        </p>

                        <div class="mt-auto pt-4 border-t border-gray-100 flex justify-between items-center text-xs font-medium text-gray-400">
                            <span>{entry.data.location}</span>
                            <span class="flex items-center gap-1 group-hover:translate-x-1 transition-transform text-ink">
                                Read File{" "}
                                <span class="material-symbols-outlined text-[14px]">
                                    arrow_forward
                                </span>
                            </span>
                        </div>
                    </a>
                ))
            }
        </div>
    </main>

    <Footer />
</Layout>
